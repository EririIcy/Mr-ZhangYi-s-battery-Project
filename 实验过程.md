# 电池项目

## 一. 硬件配置

### 1.硬件介绍

#### CS5463(电能测量)

CS5463是一款由Cirrus Logic公司设计的单相电能测量IC（集成电路），专门用于精确测量功率、电压、电流以及其他电能质量参数。它广泛应用于低成本但要求高精度的电能测量和监控系统中，例如居家能源监测器、智能插座、电能表以及各种能源管理设备。

##### CS5463的主要特性：

* **高精度测量**：CS5463提供高精度的电能、电压和电流测量能力，支持用于电费计算的电能计量。
* **多功能性**：除了基本的电能测量外，它还能测量功率因数、线性度、频率等电能质量参数。
* **串行接口**：通过SPI（串行外设接口）或类似的接口与微控制器通信，方便集成到更广泛的系统中。
* **低功耗**：设计用于低功耗应用，适合于需要长期运行的电能监测系统。
* **集成度高**：作为一个集成电路，它集成了所需的大部分功能，减少了外部组件的数量，简化了设计和降低了系统成本。

##### 应用场景：

CS5463由于其精确度高和成本效益好的特性，适用于多种应用场景，包括：

* **家庭和商业电能表**：用于测量和计算电能使用量，支持智能电表的实现。
* **能源监控系统**：用于收集电能使用数据，帮助用户监测和管理能源消耗。
* **智能家居系统**：可以集成到智能插座和开关中，提供能源使用的即时反馈和控制。
* **工业能源管理**：在工业环境中监测设备能耗，优化能源使用效率。

CS5463通过其高度集成和高性能的特点，为电能测量和管理提供了一个有效的解决方案，帮助实现能源使用的优化和成本节约。

#### NCV7344A3(CAN传输器)

NCV7344A3是一款CAN（Controller Area Network）传输器，通常用于汽车和工业应用中的网络通信。"地址硬编码"这个术语通常指的是设备地址或识别码在硬件中是预设且不可更改的，与之相对的是软件配置的地址，后者可以通过编程来改变。

在CAN网络中，每个设备都需要一个唯一的地址或标识符来进行通信。如果一个设备的地址是硬编码的，这意味着它的地址是在制造过程中设置好的，通常是通过硬件方式（如焊接引脚状态或内部固定设置），并且在设备使用期间不可更改。



#### ISO7041F(数字隔离器)

ISO7041F是德州仪器（Texas Instruments）生产的一款四通道数字隔离器。数字隔离器是用于在不同电路部分之间提供电气隔离的组件，同时允许这些部分通过数字信号进行通信。这种隔离旨在保护用户和敏感的电路部分免受高电压、电流冲击或噪声的影响，同时防止地线环路问题。

##### ISO7041F的关键特性包括：

* **通道数**：提供4个隔离的数字信号通道，可以是单向或双向数据传输。
* **隔离电压**：具有很高的隔离电压等级，通常能够承受数千伏特的电压冲击，为敏感电路提供安全保护。
* **数据传输速率**：支持较高的数据传输速率，适合需要快速数据交换的应用。
* **低功耗**：设计注重效率，以最小化电源消耗，适合用于低功耗应用。
* **稳定性和可靠性**：提供稳定可靠的数据传输，即使在存在高电压、高温或其他苛刻条件下。
* **封装类型**：通常以紧凑的封装形式提供，便于在多种电路板设计中使用。

##### 应用场景：

ISO7041F因其高性能的电气隔离能力和多通道配置，非常适合于需要隔离保护的多种应用，例如：

* **工业自动化**：在工业控制系统中，用于隔离信号处理和控制单元，以保护控制系统免受高电压或电气噪声的影响。
* **医疗设备**：在医疗电子中，提供患者安全保护，防止医疗设备中的高电压波动影响到患者或敏感设备。
* **电源管理**：用于电源供应系统，实现输入输出间的隔离，保障系统稳定性和安全性。
* **通信系统**：在通信设备中，用以隔离不同电路部分，减少系统间干扰，提高信号质量。

ISO7041F通过提供高效的数字隔离解决方案，帮助设计人员在各种应用中实现高度集成和安全的电子系统设计。



#### DRV8701(单路H桥)

DRV8701是德州仪器（Texas Instruments）生产的一款单路H桥驱动器芯片，设计用来控制小型直流电机或步进电机。H桥是一种电子电路，它允许电流在两个方向中的任何一个方向流动，从而能够控制电机的转动方向。在“单路H桥”这个术语中，“单路”指的是这个芯片能够控制一个电机的正反转。

##### DRV8701的主要功能和用途包括：

* **电机控制**：DRV8701提供正反转控制，允许电机正转、反转或制动，这对于需要精确控制电机运行状态的应用非常重要。
* **保护功能**：内置过流保护、短路保护、欠压锁定等功能，这些都是为了提高系统的可靠性和安全性。
* **调速功能**：通常通过PWM（脉冲宽度调制）信号控制电机的速度，DRV8701支持这种控制方式，能够提供平滑的速度调节。
* **接口灵活**：可通过微控制器（MCU）的数字接口来控制，方便与各种微控制器或处理器集成。

##### 应用场景：

DRV8701因其紧凑的尺寸、高度集成的功能和易于使用的特性，广泛应用于需要电机控制的各种设备中，如：

* 小型机器人或自动化设备
* 打印机和扫描仪中的纸张输送机构
* 消费电子产品中的小型风扇或泵
* 精密仪器中的定位和调节机构

H桥电路虽然主要用于控制电机的正反转和制动，但其实它还具有其他一些用途和功能：

##### 双向控制

H桥能够使负载（如电动机、电磁铁等）在两个方向上工作，这意味着它不仅限于电机控制。例如，在需要改变电流方向以控制磁场方向的应用中，H桥同样非常有用。

##### 调制电源

通过调整进入负载的电压和电流，H桥可以用来调制或调整负载所接收的功率。通过使用脉冲宽度调制（PWM）信号来控制H桥的开关，可以非常精确地控制负载的平均电源电压，这在需要调节亮度（如LED灯）或调速（如电机）的场景中非常有用。

##### 生成AC信号

H桥还可以用于生成交流（AC）信号。通过交替切换H桥的开关状态，可以将直流（DC）电源转换为AC信号。这一特性使得H桥可用于某些类型的逆变器设计，用于小型电源或电子设备中，将直流电源转换为交流电源。

##### 能量回收

在某些高级电机控制应用中，如电动汽车的制动系统，H桥可以用来实现再生制动。这时，电机实际上作为一个发电机运行，将动能转换为电能。通过H桥，这些电能可以被反馈到电池中进行存储。

##### 保护和安全

H桥电路设计中通常包括各种保护措施，如过流保护、短路保护和温度保护。这些特性确保了即使在极端条件下，电路和负载也能安全运行。

虽然H桥最著名的应用是在电机控制领域，但其灵活性和多功能性意味着它在电子和电气设计中有着更广泛的应用。

## 二.工作规划

### 1.调好对电脑串口

没有LED灯,先调好方便后面观察现象

### 2. 读电池电压

pb0-> ADC输入,  读取电池电量  从 P+接入, 量的是两个电池电压之和乘以四分之三     

一个电池电压3.7V, 两个7.4V, 两个电阻分压 四分之一 测量电压范围 0 - 1.85V





## 三. 实操问题

## 1. UART配置

### 转uart会自锁

TTL由于双向供电,如果在插拔STLINK的时候产生误触导致电脑向单片机发送了一些奇怪的信号, 会导致转TTL被锁死, 而不重新开关电源, 则一直被锁死

### 芯片无法软复位

芯片没设计硬复位键, 且软复位有概率有问题  没办法,只能每次下载完程序以后重新拔了 stlink来



记录:

不拔stlink, 断 3.3 , 断开电池都不能使程序跑

下载卡死, 拔dio, clk, stlink, 插回去, 跑

拔rst, 下载, 拔stlink,插回去, 跑

拔rst, 下载,拔dio, clk, 插回去, 跑

正常运转时候,把地拔了再插回去,也会卡死

正常运转时候,把3.3V拔了再插回去,也会卡死

任何卡死的状态,同时接上3.3和地,就能跑 

先拔地,卡死, 再插回去,竟然好了!

拔了3.3,再插回去, 一直卡死

但是! 多拔几次, 再插回去, 竟然一直好了! 接下来的接近一分钟以内,每次重新插拔都是正常

卡死->拔3.3,在查回去,卡死 拔3.3, 拔地线, 在查回去->卡死
